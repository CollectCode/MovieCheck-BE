<!DOCTYPE html>
<html>
<head>
    <title>프로필 수정</title>
    <script>
        let userKey; // 사용자 키를 전역 변수로 선언

        // 사용자 정보를 가져오는 함수
        function loadUserInfo() {
            fetch('/api/users/mypage', {
                method: 'GET',
                credentials: 'include'
            })
            .then(response => {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('사용자 정보를 불러오는 데 실패했습니다.');
            })
            .then(user => {
                // 사용자 정보를 입력 필드에 표시
                document.getElementById('userName').value = user.userName;
                document.getElementById('userContent').value = user.userContent;
                userKey = user.userKey; // 사용자 키를 전역 변수에 저장
            })
            .catch(error => {
                alert(error.message);
            });
        }

        // 이름 변경
        function updateName(event) {
            event.preventDefault(); // 기본 폼 제출 방지

            const userName = document.getElementById('userName').value;

            fetch(`/api/users/${userKey}/name`, {
                method: 'PUT',
                credentials: 'include'
            })
            .then(response => {
                if (response.ok) {
                    alert('이름이 변경되었습니다.');
                } else {
                    throw new Error('이름 변경 실패');
                }
            })
            .catch(error => {
                alert(error.message);
            });
        }

        // 비밀번호 변경
        function updatePassword(event) {
            event.preventDefault(); // 기본 폼 제출 방지

            const userPassword = document.getElementById('userPassword').value;

            fetch(`/api/users/${userKey}/password`, {
                method: 'PUT',
                credentials: 'include'
            })
            .then(response => {
                if (response.ok) {
                    alert('비밀번호가 변경되었습니다.');
                } else {
                    throw new Error('비밀번호 변경 실패');
                }
            })
            .catch(error => {
                alert(error.message);
            });
        }

        // 한 줄 소개 변경
        function updateContent(event) {
            event.preventDefault(); // 기본 폼 제출 방지

            const userContent = document.getElementById('userContent').value;

            fetch(`/api/users/${userKey}/content`, {
                method: 'PUT',
                credentials: 'include'
            })
            .then(response => {
                if (response.ok) {
                    alert('한 줄 소개가 변경되었습니다.');
                } else {
                    throw new Error('한 줄 소개 변경 실패');
                }
            })
            .catch(error => {
                alert(error.message);
            });
        }

        // 페이지 로드 시 사용자 정보 불러오기
        window.onload = loadUserInfo;
    </script>
</head>
<body>
    <h1>프로필 수정</h1>
    <form onsubmit="updateName(event)">
        <div>
            <label for="userName">닉네임:</label>
            <input type="text" id="userName" required>
            <button type="submit">이름 변경</button>
        </div>
    </form>

    <form onsubmit="updatePassword(event)">
        <div>
            <label for="userPassword">비밀번호:</label>
            <input type="password" id="userPassword" required>
            <button type="submit">비밀번호 변경</button>
        </div>
    </form>

    <form onsubmit="updateContent(event)">
        <div>
            <label for="userContent">한 줄 소개:</label>
            <input type="text" id="userContent" required>
            <button type="submit">한 줄 소개 변경</button>
        </div>
    </form>

    <button onclick="window.location.href='mypage.html'">뒤로가기</button>
</body>
</html>
